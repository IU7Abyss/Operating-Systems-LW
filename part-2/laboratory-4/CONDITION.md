# Лабораторная работа №4. Файлы и катологи

## Постановка задачи

1. Структурировать исходный код программы в листинге 4.7;
2. Изменить программу так, чтобы она выводила на экран дерево каталогов.
3. Изменить функцию `myftw()` так, чтобы каждый раз, когда встречается каталог, функции `lstat()` передавался не полный путь к файлу, а только его имя.

Для этого после обработки всех файлов в каталоге вызовите `chdir("..")`.


## Вопросы для самопроверки

1. Как создать файл с правами доступа для всех видов пользователей равными 0?

2. Как создать файл с полными доступа для всех видов пользователей?

3. Что произойдёт, если маску режима создания файлов задать равной `777`?

4. Сможете ли вы прочитать собственный файл при сброшенном бите `user-read`?

5. Какое поле структуры `stat` отвечает за размер файла? Что обозначает значение поля размера файла для символических ссылок? Чему будет равно значение этого поля для символической ссылки `lib -> /usr/lib`? Что определяют поля `st_blksize` и `st_blocks`? Какой размер буфера надо установить для минимизации времени выполнения операций ввода-вывода?

6. На примере файлов, содержащих "дырки", поясните разницу между работой команд `ls -l` и `du - s`.

7. Как уменьшить размер файла?

8. Какая функция удаляет записи из католога? Когда можно удалить файл и что происходит с его индексными узлами?

9. Что происходит при перемещении/переименовании файла в пределах одной файловой системы с фактическим содержимым файла (с его индексными узлами)? Изменяется ли при этом счётчик ссылок?

10. Файл имеет три атрибута времени: `st_atime`, `st_mtime`, `st_ctime`. Какой ключ команды `ls` позволит вывести на экран информацию о последнем изменении статуса индексного узла?

11. Когда с помощью команды `rmdir` будет удален из системы каталог?

12. Что возвращает функция `opendir()`?

13. Какая функция "читает" содержимое каталога?

14. Какие типы файлов определены в `Unix/Linux`?


## Литература

Стивенс, Раго. UNIX. Профессиональное программирование, глава 4.